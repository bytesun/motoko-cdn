(this["webpackJsonpmotoko-cdn"]=this["webpackJsonpmotoko-cdn"]||[]).push([[0],{105:function(e,t,a){"use strict";a.r(t);var c=a(2),n=a.n(c),s=a(57),r=a.n(s),l=(a(65),a(107)),i=a(116),o=a(108),d=a(109),j=a(110),u=a(111),b=a(112),h=a(113),g=a(114),p=a(115),O=(a(66),a(4)),m=(a(69),a(58)),x=a(10);const f=e=>{let{IDL:t}=e;const a=t.Int,c=t.Text,n=t.Variant({aac:t.Null,avi:t.Null,gif:t.Null,jpg:t.Null,mp3:t.Null,mp4:t.Null,png:t.Null,svg:t.Null,wav:t.Null,jpeg:t.Null}),s=t.Record({cid:t.Principal,name:t.Text,createdAt:a,size:t.Nat,fileId:c,chunkCount:t.Nat,extension:n,uploadedAt:a}),r=t.Text,l=t.Record({name:t.Text,createdAt:a,size:t.Nat,chunkCount:t.Nat,extension:n});return t.Service({getAllFiles:t.Func([],[t.Vec(s)],[]),getFileChunk:t.Func([r,t.Nat,t.Principal],[t.Opt(t.Vec(t.Nat8))],[]),getFileInfo:t.Func([r,t.Principal],[t.Opt(s)],[]),getStatus:t.Func([],[t.Vec(t.Tuple(t.Principal,t.Nat))],["query"]),putFileChunks:t.Func([r,t.Nat,t.Nat,t.Vec(t.Nat8)],[],[]),putFileInfo:t.Func([l],[t.Opt(r)],[]),updateStatus:t.Func([],[],[]),wallet_receive:t.Func([],[],[])})},v="rrkah-fqaaa-aaaaa-aaaaq-cai",N=(e,t)=>{const a=new x.c({...null===t||void 0===t?void 0:t.agentOptions});return x.a.createActor(f,{agent:a,canisterId:e,...null===t||void 0===t?void 0:t.actorOptions})};N(v);let w;!function(e){var t;e.setAuthClient=async function(e){t=e},e.getBackendActor=async function(){t||(t=await m.a.create());const e=t.getIdentity();return N(v,{agentOptions:{identity:e}})}}(w||(w={}));var y=a(1);const k=512e3,A=e=>{switch(Object.keys(e)[0]){case"jpeg":return"image/jpeg";case"gif":return"image/gif";case"jpg":return"image/jpg";case"png":return"image/png";case"svg":return"image/svg";case"avi":return"video/avi";case"mp4":return"video/mp4";case"aac":return"video/aac";case"wav":return"audio/wav";case"mp3":return"audio/mp3";default:return""}},F=e=>{let{updateDeps:t,setErrros:a}=e;const[s,r]=Object(c.useState)("Drag and drop a file or select add File"),[j,u]=Object(c.useState)({name:"",type:"",size:0,blob:new Blob,width:0,file:0,height:0}),[b,h]=Object(c.useState)(!1),[g,p]=Object(c.useState)(!1);let[O,m]=Object(c.useState)(0);const x=async(e,t,a,c,n)=>{const s=e.slice(t,Math.min(Number(n),t+k),e.type),r=await s.arrayBuffer();return(await w.getBackendActor()).putFileChunks(a,BigInt(c),BigInt(n),(e=>Array.from(new Uint8Array(e)))(r))};return g?Object(y.jsx)(n.a.Fragment,{children:Object(y.jsx)(l.a,{className:"col-8",children:Object(y.jsx)("div",{className:"image-upload-wrap",children:Object(y.jsx)(i.a,{multi:!0,children:Object(y.jsx)(i.a,{animated:!0,bar:!0,color:"success",value:O,max:"100"})})})})}):Object(y.jsx)(n.a.Fragment,{children:Object(y.jsxs)(l.a,{className:"col-8",children:[Object(y.jsx)("div",{className:"image-upload-wrap",children:Object(y.jsxs)("div",{className:"drag-text",children:[Object(y.jsx)(o.a,{className:"file-upload-input",type:"file",onChange:e=>{a([]),h(!1);const t=e.target.files[0],c=new FileReader;c.readAsDataURL(t),c.onloadend=()=>{if(null===c.result)throw new Error("file empty...");let e=c.result.toString().replace(/^data:(.*,)?/,"");e.length%4>0&&(e+="=".repeat(4-e.length%4));const a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512;const c=atob(e),n=[];for(let s=0;s<c.length;s+=a){const e=c.slice(s,s+a),t=new Array(e.length);for(let a=0;a<e.length;a++)t[a]=e.charCodeAt(a);const r=new Uint8Array(t);n.push(r)}return new Blob(n,{type:t})}(e,t.type),n={name:t.name,type:t.type,size:t.size,blob:a,file:t,width:t.width,height:t.height};r(t.name+" | "+Math.round(t.size/1e3)+" kB"),u(n),h(!0)}}}),Object(y.jsx)("h3",{children:s}),Object(y.jsx)("img",{src:"http://100dayscss.com/codepen/upload.svg",className:"upload-icon"})]})}),!!b&&Object(y.jsx)(d.a,{className:"file-upload-btn",type:"button",onClick:async e=>{e.preventDefault();const c=(e=>{switch(e){case"image/jpeg":return{jpeg:null};case"image/gif":return{gif:null};case"image/jpg":return{jpg:null};case"image/png":return{png:null};case"image/svg":return{svg:null};case"video/avi":return{avi:null};case"video/aac":return{aac:null};case"video/mp4":return{mp4:null};case"audio/wav":return{wav:null};case"audio/mp3":return{mp3:null};default:return null}})(j.type);console.log(c);const n=[];if(null!==j&&void 0!==j&&null!==c||n.push("File not valid!"),j.size>1055e4&&n.push("File size shouldn't be bigger than 10mb"),n.length>0)return void a(n);const s=performance.now();console.log("upload started..."),p(!0);const l={name:Math.random().toString(36).substring(2),createdAt:BigInt(Number(1e3*Date.now())),size:BigInt(j.size),chunkCount:BigInt(Number(Math.ceil(j.size/k))),extension:c},i=await w.getBackendActor();m(10);const o=(await i.putFileInfo(l))[0];m(40);const d=j.blob,u=[];let b=1;for(let t=0;t<d.size;t+=k,b++)u.push(x(d,t,o,b,j.size));await Promise.all(u),await i.updateStatus(),m(100),p(!1),h(!1),t(),r("Drag and drop a file or select add File");const g=performance.now();console.log("Upload took "+(g-s)/1e3+" seconds.")},children:"Upload"})]})})},S=e=>{let{rerender:t}=e,[a,s]=Object(c.useState)([]),[r,i]=Object(c.useState)(!1);Object(c.useEffect)((()=>{console.log("triggers canisters"),i(!0),o()}),[t]);const o=Object(c.useCallback)((async()=>{console.log("updating....");const e=await w.getBackendActor(),t=await e.getStatus();s(t),i(!1)}),[]);return r?Object(y.jsx)("div",{className:"spinner-border",role:"status"}):Object(y.jsx)(n.a.Fragment,{children:Object(y.jsx)(l.a,{className:"col-12",children:a.map((e=>{const t=O.a.fromUint8Array(e[0].toUint8Array()).toText();return Object(y.jsx)("ul",{className:"list-group",children:Object(y.jsxs)("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[t,Object(y.jsxs)("span",{className:"badge badge-primary badge-pill text-danger",children:["Free space: ",Number(e[1])/1e3," Kb"]})]})})}))})})},C=e=>{let{rerender:t}=e;const[a,s]=Object(c.useState)([]),[r,i]=Object(c.useState)(""),[o,p]=Object(c.useState)(!1),[m,x]=Object(c.useState)(!1),[f,v]=Object(c.useState)(0);Object(c.useEffect)((()=>{console.log("triggers files..."),x(!0),N()}),[t]);const N=async()=>{const e=await w.getBackendActor(),t=await e.getAllFiles();s(t),x(!1)},k=(e,t)=>{e.preventDefault(),v(t)};if(m)return Object(y.jsx)(l.a,{className:"col-6",children:Object(y.jsx)("div",{className:"spinner-border",role:"status"})});const F=Math.ceil(a.length/5);return Object(y.jsx)(n.a.Fragment,{children:Object(y.jsxs)(j.a,{children:[Object(y.jsxs)(l.a,{className:"col-6",children:[Object(y.jsxs)(u.a,{children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"ID"}),Object(y.jsx)("th",{children:"Size"}),Object(y.jsx)("th",{children:"Extension"}),Object(y.jsx)("th",{children:"Canister ID"}),Object(y.jsx)("th",{children:"View"})]})}),Object(y.jsx)("tbody",{children:a.slice(5*f,5*(f+1)).map(((e,t)=>{console.log(e);const a=O.a.fromUint8Array(e.cid.toUint8Array()).toText(),c=Object.keys(e.extension)[0];return Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:e.fileId}),Object(y.jsxs)("td",{children:[Number(e.size)/1e3," Kb"]}),Object(y.jsx)("td",{children:c}),Object(y.jsx)("td",{children:a}),Object(y.jsx)("td",{children:Object(y.jsx)(d.a,{onClick:t=>(async(e,t)=>{e.preventDefault(),i(""),p(!0);const a=await w.getBackendActor(),c=[];for(let r=1;r<=Number(t.chunkCount);r++){const e=await a.getFileChunk(t.fileId,BigInt(r),t.cid);e[0]&&c.push(new Uint8Array(e[0]).buffer)}const n=new Blob(c,{type:A(t.extension)}),s=URL.createObjectURL(n);i(s),p(!1)})(t,e),children:"Load"})})]},t)}))})]}),Object(y.jsxs)(b.a,{"aria-label":"cdn navigation",children:[Object(y.jsx)(h.a,{disabled:f<=0,children:Object(y.jsx)(g.a,{onClick:e=>k(e,f-1),previous:!0,href:"#"})}),[...Array(F)].map(((e,t)=>Object(y.jsx)(h.a,{active:t===f,children:Object(y.jsx)(g.a,{onClick:e=>k(e,t),href:"#",children:t+1})},t))),Object(y.jsx)(h.a,{disabled:f>=F-1,children:Object(y.jsx)(g.a,{onClick:e=>k(e,f+1),next:!0,href:"#"})})]})]}),Object(y.jsxs)(l.a,{className:"col-6",children:[o&&Object(y.jsx)("div",{className:"spinner-border",role:"status"}),""!==r&&Object(y.jsxs)("div",{children:[Object(y.jsxs)("p",{children:["Open this in a new tab: ",r]}),Object(y.jsx)(d.a,{onClick:()=>{navigator.clipboard.writeText(r)},children:"Copy to clipboard"}),Object(y.jsx)(d.a,{onClick:()=>{""!==r&&(URL.revokeObjectURL(r),i(""))},children:"Clean Blob"})]})]})]})})};var B=function(){const[e,t]=Object(c.useState)(!1),[a,n]=Object(c.useState)([]);return Object(y.jsxs)("div",{className:"App",children:[Object(y.jsxs)(p.a,{children:[Object(y.jsx)("br",{}),Object(y.jsx)("br",{}),a&&a.map((e=>Object(y.jsx)("div",{className:"alert alert-danger",role:"alert",children:e}))),Object(y.jsx)("br",{}),Object(y.jsx)("br",{}),Object(y.jsxs)(j.a,{children:[Object(y.jsx)(l.a,{className:"col-12",children:Object(y.jsx)("div",{className:"alert alert-warning",role:"alert",children:"Max file size: 10mb ----- Accepted extensions: jpeg, gif, jpg, png, svg, avi, aac, mp4, wav, mp3"})}),Object(y.jsx)(l.a,{className:"col-6",children:Object(y.jsx)(F,{updateDeps:()=>{console.log("force reupdate child..."),t(!e)},setErrros:n})}),Object(y.jsx)(l.a,{className:"col-6",children:Object(y.jsx)(S,{rerender:e})})]}),Object(y.jsx)("br",{}),Object(y.jsx)("br",{}),Object(y.jsx)(C,{rerender:e}),Object(y.jsx)("br",{}),Object(y.jsx)("br",{})]}),Object(y.jsx)("footer",{className:"footer",children:Object(y.jsxs)("div",{className:"alert alert-info",role:"alert",children:["You can check the code here:",Object(y.jsx)("a",{href:"https://github.com/gabrielnic/motoko-cdn",target:"_blank",className:"alert-link",children:" Source Code"})]})})]})};r.a.render(Object(y.jsx)(n.a.StrictMode,{children:Object(y.jsx)(B,{})}),document.getElementById("root"))},65:function(e,t,a){},69:function(e,t,a){},77:function(e,t){},83:function(e,t){},84:function(e,t){}},[[105,1,2]]]);
//# sourceMappingURL=main.6d12cf0d.chunk.js.map